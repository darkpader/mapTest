<!DOCTYPE html>
<html>
  <head>
    <title>Interactive Map with Speech</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <style>
      #map {
        height: 100vh;
      }
      .tooltip-style {
        font-size: 14px;
        background: white;
        border: 1px solid gray;
        padding: 4px;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <script>
      const map = L.map("map").setView([20, 0], 2);

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "&copy; OpenStreetMap contributors",
      }).addTo(map);

      // Country ISO -> Description
      const countryDescriptions = {
        SEN: "Hello There",
        AGO: "General Kenobi, you are a bold one",
        CAN: "Back away, I will deal with this Jedi slime myself",
        EGY: "Your move",
      };

      // Cities with coordinates and descriptions
      const cityDescriptions = [
        {
          name: "London, UK",
          lat: 51.5074,
          lon: -0.1278,
          description:
            "You fool, I've been trained in your Jedi arts by Count Dooku",
        },
        {
          name: "Dubai, UAE",
          lat: 25.276987,
          lon: 55.296249,
          description: "Attack, Kenobi",
        },
      ];

      // Function to speak text
      function speak(text) {
        speechSynthesis.cancel(); // Stop previous speech
        const utter = new SpeechSynthesisUtterance(text);
        speechSynthesis.speak(utter);
      }

      // Load GeoJSON country boundaries
      fetch(
        "https://raw.githubusercontent.com/johan/world.geo.json/master/countries.geo.json"
      )
        .then((res) => res.json())
        .then((data) => {
          // Add countries first
          L.geoJSON(data, {
            style: (feature) => ({
              fillColor: countryDescriptions[feature.id] ? "#3498db" : "#ccc",
              weight: 1,
              color: "#fff",
              fillOpacity: countryDescriptions[feature.id] ? 0.5 : 0.1,
            }),
            onEachFeature: (feature, layer) => {
              const iso = feature.id;
              const desc = countryDescriptions[iso];
              if (desc) {
                layer.bindTooltip(
                  `<strong>${feature.properties.name}</strong><br>${desc}`,
                  {
                    sticky: true,
                    className: "tooltip-style",
                  }
                );

                layer.on("mouseover", () => {
                  layer.setStyle({ fillOpacity: 0.8 });
                  speak(desc);
                });
                layer.on("mouseout", () => {
                  layer.setStyle({ fillOpacity: 0.5 });
                  speechSynthesis.cancel();
                });
              }
            },
          }).addTo(map);

          // Add city markers after countries so they appear on top
          cityDescriptions.forEach((city) => {
            const marker = L.circleMarker([city.lat, city.lon], {
              radius: 6,
              fillColor: "#e67e22",
              color: "#000",
              weight: 1,
              opacity: 1,
              fillOpacity: 0.9,
            }).addTo(map);

            marker.bindTooltip(
              `<strong>${city.name}</strong><br>${city.description}`,
              {
                sticky: true,
                className: "tooltip-style",
              }
            );

            marker.on("mouseover", () => speak(city.description));
            marker.on("mouseout", () => speechSynthesis.cancel());
          });
        });
    </script>
  </body>
</html>
